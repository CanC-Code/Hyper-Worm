<script>
///// made by CanC-Code / CCVO
///// Purpose: Global network/fetch error trap with copy functionality

// Create the error popup container
const errorPopup = document.createElement("div");
errorPopup.style.position = "fixed";
errorPopup.style.bottom = "20px";
errorPopup.style.left = "50%";
errorPopup.style.transform = "translateX(-50%)";
errorPopup.style.background = "#ff6b6b";
errorPopup.style.color = "#fff";
errorPopup.style.padding = "1rem";
errorPopup.style.borderRadius = "6px";
errorPopup.style.boxShadow = "0 4px 10px rgba(0,0,0,0.3)";
errorPopup.style.fontFamily = "monospace";
errorPopup.style.maxWidth = "90%";
errorPopup.style.zIndex = "9999";
errorPopup.style.display = "none";
errorPopup.style.whiteSpace = "pre-wrap";

const errorMessage = document.createElement("div");
errorPopup.appendChild(errorMessage);

const copyBtn = document.createElement("button");
copyBtn.textContent = "Copy Error";
copyBtn.style.marginTop = "0.5rem";
copyBtn.style.cursor = "pointer";
copyBtn.style.padding = "0.2rem 0.5rem";
copyBtn.style.border = "none";
copyBtn.style.borderRadius = "4px";
copyBtn.style.background = "#fff";
copyBtn.style.color = "#ff6b6b";
copyBtn.onclick = () => {
    navigator.clipboard.writeText(errorMessage.textContent).then(() => {
        copyBtn.textContent = "Copied!";
        setTimeout(() => copyBtn.textContent = "Copy Error", 1500);
    });
};
errorPopup.appendChild(copyBtn);

document.body.appendChild(errorPopup);

// Function to show the popup with message
function showError(msg) {
    errorMessage.textContent = msg;
    errorPopup.style.display = "block";
    setTimeout(() => { errorPopup.style.display = "none"; }, 10000);
}

// Global error trap for resources
window.addEventListener("error", (e) => {
    if (e.target && e.target.tagName) {
        const msg = `RESOURCE LOAD ERROR: ${e.target.tagName} - ${e.target.src || e.target.href}`;
        console.error(msg);
        showError(msg);
    }
}, true);

// Wrapped fetch to catch network errors
const originalFetch = window.fetch;
window.fetch = async (...args) => {
    try {
        const res = await originalFetch(...args);
        if (!res.ok) {
            const msg = `FETCH FAILED: ${args[0]} - Status: ${res.status}`;
            console.error(msg);
            showError(msg);
        }
        return res;
    } catch (err) {
        const msg = `FETCH NETWORK ERROR: ${args[0]} - ${err.message}`;
        console.error(msg);
        showError(msg);
        throw err;
    }
};
</script>